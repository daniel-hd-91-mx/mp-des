<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa R√°pido para Salir de la Zona de Desgaste</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Source+Serif+Pro:wght@400;900&display=swap');
        
        body {
            background-color: #f9fafb;
        }
        .font-serif { 
            font-family: 'Source Serif Pro', serif; 
        }
        .font-sans { 
            font-family: 'Open Sans', sans-serif; 
        }
        
        .slider-track {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 9999px;
            cursor: pointer;
        }

        .slider-track::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #f9442c;
            cursor: pointer;
            border-radius: 50%;
            margin-top: -8px;
            border: 3px solid black;
        }

        .slider-track::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #f9442c;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid black;
        }
    </style>
</head>
<body>

    <div id="app" class="mx-auto max-w-md p-4 space-y-6 font-sans">
        
        <img src="https://raw.githubusercontent.com/daniel-hd-91-mx/mp-des/main/Logo-Dan-Hd_Imagotipo-BLACK.png" alt="Logo" class="mx-auto w-[250px] pt-4" />

        <!-- Form View -->
        <div id="form-view">
            <div class="border bg-white text-gray-800 shadow-sm rounded-lg">
                <div class="p-6 relative">
                    <!-- Icono de Informaci√≥n -->
                    <div id="infoIcon" class="absolute top-4 left-4 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 hover:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>

                    <h1 class="text-2xl text-center font-extrabold font-serif leading-tight mb-4 mt-8">Tu Mapa R√°pido para Salir de la Zona de Desgaste</h1>
                    <p class="text-sm font-sans text-center">En menos de 3 minutos descubres d√≥nde est√°s y recibes un plan r√°pido para recuperar energ√≠a y claridad.</p>
                    <hr class="my-6 border-gray-200" />
                    <p class="text-base text-center font-bold font-serif mb-6">Responde las siguientes preguntas, tomando en cuenta tus √∫ltimos 3 meses.</p>
                    
                    <div class="space-y-8">
                        <!-- ARC Slider -->
                        <div>
                            <p class="text-base text-center font-medium font-serif mb-2">¬øEn qu√© proporci√≥n las situaciones emergentes desplazan tus actividades directivas?</p>
                            <div class="mt-4">
                                <input id="arcSlider" type="range" min="0" max="100" step="1" value="50" class="slider-track" />
                            </div>
                            <div class="flex justify-between text-xs mt-2">
                                <div class="text-left">
                                    <p class="opacity-90 font-sans leading-tight">% de urgencias (actividades)</p>
                                    <p class="opacity-90 font-sans text-[11px] leading-tight">que no delegas:</p>
                                    <p><span id="arcValueDisplay" style="color: #f9442c;" class="font-semibold text-lg">50%</span></p>
                                </div>
                                <div class="text-right">
                                    <p class="opacity-80 font-sans leading-tight">% de actividades</p>
                                    <p class="opacity-80 font-sans text-[11px] leading-tight">de tu rol directivo:</p>
                                    <p><span id="compArcDisplay" class="font-semibold text-lg">50%</span></p>
                                </div>
                            </div>
                        </div>
                        <hr class="border-gray-200" />
                        <!-- CE Slider -->
                        <div>
                            <p class="text-base text-center font-medium font-serif mb-2">¬øEn qu√© proporci√≥n resuelves problemas de otros en lugar de dirigir?</p>
                            <div class="mt-4">
                                <input id="ceSlider" type="range" min="0" max="100" step="1" value="50" class="slider-track" />
                            </div>
                             <div class="flex justify-between text-xs mt-2">
                                <div class="text-left">
                                    <p class="opacity-90 font-sans leading-tight">% de horas</p>
                                    <p class="opacity-90 font-sans text-[11px] leading-tight">resolviendo por otros:</p>
                                    <p><span id="ceValueDisplay" style="color: #f9442c;" class="font-semibold text-lg">50%</span></p>
                                </div>
                                <div class="text-right">
                                    <p class="opacity-80 font-sans leading-tight">% de horas</p>
                                    <p class="opacity-80 font-sans text-[11px] leading-tight">en tu rol directivo:</p>
                                    <p><span id="compCeDisplay" class="font-semibold text-lg">50%</span></p>
                                </div>
                            </div>
                        </div>
                        <hr class="border-gray-200" />
                        <!-- SP Slider -->
                        <div>
                            <p class="text-base text-center font-medium font-serif mb-2">¬øEn qu√© proporci√≥n distribuyes tu tiempo entre tu negocio y familia?</p>
                            <div class="mt-4">
                                <input id="spSlider" type="range" min="0" max="100" step="1" value="50" class="slider-track" />
                            </div>
                            <div class="flex justify-between text-xs mt-2">
                               <div class="text-left">
                                    <p class="opacity-90 font-sans leading-tight">% de horas</p>
                                    <p class="opacity-90 font-sans text-[11px] leading-tight">dedicadas al trabajo:</p>
                                    <p><span id="spValueDisplay" style="color: #f9442c;" class="font-semibold text-lg">50%</span></p>
                                </div>
                               <div class="text-right">
                                    <p class="opacity-80 font-sans leading-tight">% de horas</p>
                                    <p class="opacity-80 font-sans text-[11px] leading-tight">de vida personal:</p>
                                    <p><span id="compSpDisplay" class="font-semibold text-lg">50%</span></p>
                                </div>
                            </div>
                            <p class="text-[11px] mt-1 opacity-70 font-sans italic">*Esta respuesta influye m√°s en tu resultado final.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border bg-white text-gray-800 shadow-sm rounded-lg mt-6">
                <div class="p-6 text-center text-sm font-sans">
                    <p>‚õìÔ∏è‚Äçüí• Deja de ser esclavo de tu negocio</p>
                    <p>ü•∞ Disfruta a tu familia y tu vida</p>
                </div>
            </div>
            <button id="verResultadoBtn" class="w-full mt-6 inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 disabled:opacity-50 disabled:cursor-not-allowed" style="background-color: #f9442c; color: white;" disabled>Ver mi resultado</button>
            <p id="microcopy" class="text-xs text-center text-gray-500 mt-2">Mueve los 3 controles para activar tu resultado</p>
        </div>

        <!-- Result View (hidden by default) -->
        <div id="result-view" class="hidden">
             <div class="border bg-white text-gray-800 shadow-sm rounded-lg text-center">
                 <div class="p-6 space-y-2">
                     <h2 id="resultTitulo" class="text-2xl font-bold font-serif" style="color: #f9442c;"></h2>
                     <p class="text-sm text-gray-600">Nivel de Esclavitud al Negocio (NEN): <strong id="resultNen" class="text-black"></strong></p>
                     <p id="resultMensaje" class="font-semibold pt-2"></p>
                     <img src="https://raw.githubusercontent.com/daniel-hd-91-mx/mp-des/main/comparte.png" alt="Comparte tu resultado" class="mx-auto w-[250px] pt-2">
                 </div>
             </div>
             <div class="space-y-3 pt-4">
                 <button id="downloadPdfBtn" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2" style="background-color: #f9442c; color: white;">Descargar mi Mapa Personalizado</button>
                 <a href="https://www.instagram.com/coach.danhd" target="_blank" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-black text-white hover:bg-gray-800">Enviar DM</a>
                 <button id="resetBtn" class="w-full bg-transparent text-gray-800 border border-gray-300 hover:bg-gray-100 inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2">Reiniciar actividad</button>
             </div>
             <p class="text-xs text-center text-gray-500 mt-4">No guardo tus respuestas. Puedes descargar tu PDF y cerrar la ventana.</p>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-full overflow-y-auto">
            <div class="p-6 relative">
                <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <h2 class="text-2xl font-bold font-serif text-center mb-4">Gu√≠a de uso ‚Äî ‚ÄúMapa R√°pido para Salir de la Zona de Desgaste‚Äù</h2>
                <div class="text-sm text-gray-700 space-y-4 font-sans">
                    <div>
                        <h3 class="font-bold text-base mb-1">1) Qu√© es</h3>
                        <p>La <strong class="font-semibold">zona de desgaste</strong> es el inicio de la esclavitud con tu negocio. Ya no diriges: sobrevives. Las urgencias controlan tu agenda, haces tareas que no son tuyas y sacrificas tu vida personal creyendo que todo depende de ti. Detectarla a tiempo te permite romper ese patr√≥n y volver a liderar con claridad.</p>
                    </div>
                    <div>
                        <h3 class="font-bold text-base mb-1">2) C√≥mo usarla</h3>
                        <ul class="list-disc list-inside space-y-1">
                            <li>Mueve los tres controles seg√∫n tus √∫ltimos 3 meses.</li>
                            <li>Activa el bot√≥n <strong class="font-semibold">‚ÄúVer mi resultado‚Äù</strong> cuando los tres est√©n ajustados.</li>
                            <li>Lee tu nivel de <strong class="font-semibold">Esclavitud al Negocio</strong> y el mensaje clave.</li>
                            <li>Descarga tu PDF con el plan r√°pido.</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-base mb-1">3) Qu√© mide cada pregunta</h3>
                         <ul class="list-disc list-inside space-y-1">
                            <li>¬øQu√© tanto tus urgencias desplazan tu rol de direcci√≥n?</li>
                            <li>¬øQu√© tanto resuelves problemas de otros en lugar de liderar?</li>
                            <li>¬øQu√© tanto tu tiempo se inclina hacia el trabajo y no hacia tu vida personal?</li>
                            <li class="list-none text-xs italic ml-4">(Esta √∫ltima pesa m√°s en el resultado final).</li>
                        </ul>
                    </div>
                     <div>
                        <h3 class="font-bold text-base mb-1">4) Guardar o compartir</h3>
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong class="font-semibold">Descargar resultados:</strong> crea tu PDF con tu Mapa R√°pido.</li>
                            <li><strong class="font-semibold">Enviar DM:</strong> abre Instagram para compartirme tu resultado y conversar sobre tus siguientes pasos.</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-base mb-1">5) Privacidad</h3>
                        <p>No guardo tus respuestas en el servidor. El PDF es solo tuyo.</p>
                    </div>
                     <div>
                        <h3 class="font-bold text-base mb-1">6) Problemas frecuentes</h3>
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong class="font-semibold">No se activa ‚ÄúVer mi resultado‚Äù:</strong> mueve los tres controles al menos una vez.</li>
                            <li><strong class="font-semibold">El PDF no descarga:</strong> espera a que aparezca activo el bot√≥n y vuelve a intentar.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- State Variables ---
            let arc = 50;
            let ce = 50;
            let sp = 50;
            let result = null;
            let jsPdfLoaded = false;
            let sliderInteracted = {
                arc: false,
                ce: false,
                sp: false
            };
            const LOGO = "https://raw.githubusercontent.com/daniel-hd-91-mx/mp-des/main/Logo-Dan-Hd_Imagotipo-BLACK.png";
            const SHARE_IMG = "https://raw.githubusercontent.com/daniel-hd-91-mx/mp-des/main/comparte.png";

            // --- DOM Elements ---
            const formView = document.getElementById('form-view');
            const resultView = document.getElementById('result-view');
            
            const arcSlider = document.getElementById('arcSlider');
            const ceSlider = document.getElementById('ceSlider');
            const spSlider = document.getElementById('spSlider');

            const arcValueDisplay = document.getElementById('arcValueDisplay');
            const ceValueDisplay = document.getElementById('ceValueDisplay');
            const spValueDisplay = document.getElementById('spValueDisplay');

            const compArcDisplay = document.getElementById('compArcDisplay');
            const compCeDisplay = document.getElementById('compCeDisplay');
            const compSpDisplay = document.getElementById('compSpDisplay');
            
            const verResultadoBtn = document.getElementById('verResultadoBtn');
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            const resetBtn = document.getElementById('resetBtn');
            const microcopy = document.getElementById('microcopy');

            const infoIcon = document.getElementById('infoIcon');
            const infoModal = document.getElementById('infoModal');
            const closeModalBtn = document.getElementById('closeModalBtn');

            // --- Load jsPDF ---
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
            script.async = true;
            script.onload = () => { jsPdfLoaded = true; };
            document.body.appendChild(script);

            // --- Functions ---
            const checkButtonState = () => {
                if (sliderInteracted.arc && sliderInteracted.ce && sliderInteracted.sp) {
                    verResultadoBtn.disabled = false;
                    microcopy.style.display = 'none';
                } else {
                    verResultadoBtn.disabled = true;
                    microcopy.style.display = 'block';
                }
            };

            const updateSliderTrack = (slider) => {
                const percentage = ((slider.value - slider.min) * 100) / (slider.max - slider.min);
                slider.style.background = `linear-gradient(to right, #f9442c ${percentage}%, #e5e7eb ${percentage}%)`;
            };

            const clasificar = (arc, ce, sp, nen) => {
                const highs = [arc, ce, sp].filter(v => v >= 70).length;

                // Casos l√≠mite nuevos
                if (sp < 30 && arc < 40 && ce < 40) {
                    return {
                        titulo: "Liderazgo en Riesgo",
                        mensaje: "Al bajar demasiado el trabajo, el negocio pierde pulso. Equilibra sin soltar el tim√≥n.",
                        detalle: "Has logrado un gran balance personal, pero es crucial asegurar que las √°reas clave del negocio no queden desatendidas. El liderazgo libre requiere supervisi√≥n activa, no ausencia."
                    };
                }
                
                if (arc < 40 && ce >= 70) {
                     return {
                        titulo: "Delegaci√≥n Inconsistente",
                        mensaje: "Evitas las urgencias, pero sigues resolviendo por otros. Es control disfrazado de orden.",
                        detalle: "Aunque no vives en modo 'bombero', tu equipo a√∫n depende de ti para resolver sus problemas. Esto crea un cuello de botella y limita su crecimiento."
                    };
                }

                // L√≥gica original
                if (nen >= 70 || highs >= 2 || (sp >= 70 && arc >= 60)) {
                    return {
                    titulo: "Esclavitud Cr√≠tica",
                    mensaje: "Tu negocio dicta tu vida. Est√°s en riesgo de colapso f√≠sico, emocional y relacional.",
                    detalle: "Tu negocio gobierna tu vida. Est√°s atrapado en urgencias, resolviendo por otros y sacrificando tu vida personal en exceso."
                    };
                }

                if (nen >= 40 || [arc, ce, sp].some(v => v >= 70)) {
                    return {
                    titulo: "Esclavitud Moderada",
                    mensaje: "Equilibrio fr√°gil: est√°s en el momento ideal para hacer ajustes y evitar escalar.",
                    detalle: "Tu situaci√≥n es manejable, pero ya muestra se√±ales de absorci√≥n excesiva del negocio."
                    };
                }

                return {
                    titulo: "Liderazgo Libre",
                    mensaje: "Diriges con equilibrio. El reto es sostenerlo y crecer sin recaer.",
                    detalle: "Has logrado un balance sano entre rol directivo, delegaci√≥n y vida personal."
                };
            };
            
            const generarPDF = () => {
                if (!jsPdfLoaded || !window.jspdf) {
                    console.warn("La librer√≠a PDF no ha cargado. Por favor, intente de nuevo en un momento.");
                    return;
                }
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ unit: "pt", format: "a4" });
                const pageW = doc.internal.pageSize.getWidth();
                const margin = 36, lh = 18;
                const maxW = pageW - (margin * 2); 
                let y = 64;

                const logoWidth = 250;
                const logoX = (pageW - logoWidth) / 2;
                try { doc.addImage(LOGO, "PNG", logoX, y, logoWidth, 0, undefined, 'FAST'); y += 120; } catch (e) { console.error("Error loading logo for PDF:", e); }

                const add = (t, f=12, b=false, face = 'helvetica', align = 'left') => {
                    doc.setFontSize(f); doc.setFont(face, b? 'bold':'normal');
                    const lines = doc.splitTextToSize(t, maxW);
                    const xPos = align === 'center' ? pageW / 2 : margin;
                    if (y + lines.length*lh > doc.internal.pageSize.getHeight() - 64) { doc.addPage(); y = 64; }
                    doc.text(lines, xPos, y, { align });
                    y += lines.length*lh + 6;
                };
                
                doc.setFontSize(20); doc.setFont('times', 'bold');
                doc.text("Tu Mapa R√°pido para Salir de la Zona de Desgaste", pageW / 2, y, { align: 'center' });
                y += 20 + 6; 

                doc.setFontSize(12); doc.setFont('helvetica', 'normal');
                doc.text("Un plan simple para recuperar energ√≠a, claridad y equilibrio en tu negocio y tu vida.", pageW / 2, y, { align: 'center' });
                y += 12 + 18;
                
                add("La zona de desgaste no es agotamiento total ni plenitud. Es esa franja gris en la que trabajas, pero te cuesta disfrutar tu vida y mantener claridad. Este informe traduce tus respuestas en un mapa r√°pido: d√≥nde est√°s hoy y qu√© puedes hacer para recuperar energ√≠a y direcci√≥n.");
                
                y += 12;
                doc.setDrawColor(220, 220, 220); doc.setLineWidth(1);
                doc.line(margin, y, pageW - margin, y);
                y += 24;

                const nen = Math.round((arc + ce + 3*sp) / 5);
                const nivel = result ?? { nen, ...clasificar(arc, ce, sp, nen) };

                const renderColoredResults = () => {
                    doc.setFontSize(12); doc.setFont('helvetica', 'normal');
                    const line = `Urgencias: ${arc}%  |  Resolver por otros: ${ce}%  |  Trabajo vs vida: ${sp}%`;
                    const totalWidth = doc.getStringUnitWidth(line) * doc.getFontSize();
                    const startX = (pageW - totalWidth) / 2;
                    let currentX = startX;
                    const printSegment = (text, isHigh) => {
                        doc.setTextColor(isHigh ? 249 : 0, isHigh ? 68 : 0, isHigh ? 44 : 0);
                        doc.text(text, currentX, y);
                        currentX += doc.getStringUnitWidth(text) * doc.getFontSize();
                    };
                    printSegment("Urgencias: ", false); printSegment(`${arc}%`, arc >= 70);
                    printSegment("  |  Resolver por otros: ", false); printSegment(`${ce}%`, ce >= 70);
                    printSegment("  |  Trabajo vs vida: ", false); printSegment(`${sp}%`, sp >= 70);
                    doc.setTextColor(0, 0, 0); 
                    y += lh + 6;
                };
                renderColoredResults();
                
                add(`Nivel: ${nivel.titulo} ¬∑ NEN: ${nivel.nen}%`, 12, false, 'helvetica', 'center');
                add(nivel.mensaje);
                add(nivel.detalle);

                y += 24;
                const headerText = "Mapa de Acci√≥n ¬∑ 3 pasos para esta semana";
                doc.setFontSize(16); doc.setFont('times', 'bold');
                doc.text(headerText, margin, y);
                const textWidth = doc.getStringUnitWidth(headerText) * doc.getFontSize();
                doc.setLineWidth(1);
                doc.line(margin, y + 3, margin + textWidth, y + 3);
                y += lh * 1.5;

                const addActionSection = (title, actionText, questionText) => {
                    if (y + 120 > doc.internal.pageSize.getHeight() - 64) { doc.addPage(); y = 64; }
                    doc.setFontSize(12); doc.setFont('helvetica', 'bold');
                    doc.text(title, margin, y);
                    y += lh * 1.5;
                    doc.setFont('helvetica', 'normal');
                    let lines = doc.splitTextToSize(actionText, maxW);
                    doc.text(lines, margin, y);
                    y += lines.length * lh + 6;
                    const questionLine = `Pregunta reflexiva: ‚Äú${questionText}‚Äù`;
                    lines = doc.splitTextToSize(questionLine, maxW);
                    doc.text(lines, margin, y);
                    y += lines.length * lh + 24;
                };
                
                let arcAction, arcQuestion;
                if (arc > 70) { arcAction = "Haz una lista de las urgencias del √∫ltimo mes. Escribe qui√©n pod√≠a resolverlas y por qu√© terminaste haci√©ndolo t√∫."; arcQuestion = "¬øEres t√∫ quien las busca, o es tu patr√≥n de control el que no suelta?"; }
                else if (arc >= 40) { arcAction = "Reserva 30 minutos diarios solo para actividades estrat√©gicas. Bloqu√©alo en tu agenda como cita inamovible."; arcQuestion = "¬øDefendiste ese espacio o lo regalaste a lo urgente?"; }
                else { arcAction = "Documenta c√≥mo resolviste tu √∫ltima urgencia y entr√©galo a quien deba manejarla la pr√≥xima vez. No intervengas, observa."; arcQuestion = "¬øNotas confianza en tu equipo‚Ä¶ o en ti mismo al soltar?"; }
                addActionSection("Acci√≥n #1 (Urgencias)", arcAction, arcQuestion);

                let ceAction, ceQuestion;
                if (ce > 70) { ceAction = "Elige una tarea que siempre terminas haciendo por tu equipo. Esta semana entr√©gala de principio a fin. No la retomes aunque no salga perfecta."; ceQuestion = "¬øQuieres ser indispensable o prefieres ser libre?"; }
                else if (ce >= 40) { ceAction = "Haz una lista de tres actividades que hiciste en lugar de tu equipo. Suelta una esta semana. Acompa√±a con retroalimentaci√≥n, pero no ejecutes t√∫ la tarea."; ceQuestion = "¬øQu√© pesa m√°s en ti: miedo a que fallen o miedo a dejar de sentirte necesario?"; }
                else { ceAction = "Cada mes registra qu√© decisiones tom√≥ tu equipo sin ti. Recon√≥celas p√∫blicamente y preg√∫ntales."; ceQuestion = "¬øQu√© m√°s necesitan para seguir decidiendo solos?"; }
                addActionSection("Acci√≥n #2 (Resolver por otros)", ceAction, ceQuestion);

                let spAction, spQuestion;
                if (sp > 70) { spAction = "Bloquea una hora a mitad de la semana y n√≥mbrala: Hora Vital. Prot√©gela como si fuera tu cita m√°s importante."; spQuestion = "¬øQu√© me cuesta m√°s, sostener esa hora‚Ä¶ o aceptar que mi vida vale tanto como mi empresa?"; }
                else if (sp >= 40) { spAction = "Crea un ritual de cierre diario. Escribe el √∫ltimo pendiente, apaga tu computadora y da una caminata de 10 minutos. Hazlo por una semana."; spQuestion = "¬øQu√© cambia en tu descanso cuando honras ese cierre?"; }
                else { spAction = "Agenda una actividad mensual solo por disfrute (hobby, experiencia, viaje corto). Ponla antes que tus juntas en el calendario."; spQuestion = "¬øPuedes disfrutarla sin sentir culpa?"; }
                addActionSection("Acci√≥n #3 (Trabajo vs Vida)", spAction, spQuestion);
                
                y += 12;
                const cierreText = "Este mapa no es teor√≠a: son pasos reales que puedes aplicar de inmediato. El desgaste no define qui√©n eres; lo importante es salir a tiempo y sostener el equilibrio.";
                doc.setFontSize(12); doc.setFont('helvetica', 'normal');
                const cierreLines = doc.splitTextToSize(cierreText, maxW - 80);
                
                let maxWidth = 0;
                cierreLines.forEach(line => { const lineWidth = doc.getTextWidth(line); if (lineWidth > maxWidth) maxWidth = lineWidth; });

                const padding = 15;
                const rectH = (cierreLines.length * (lh - 4)) + (2 * padding);
                const rectW = maxWidth + (2 * padding);
                const rectX = (pageW - rectW) / 2;
                const rectY = y;

                doc.setDrawColor(249, 68, 44); doc.setLineWidth(3);
                doc.rect(rectX, rectY, rectW, rectH);
                doc.setTextColor(0,0,0);
                doc.text(cierreLines, pageW / 2, y + padding + 6, { align: 'center' });
                y += rectH + 24;

                const shareImgWidth = 250;
                const shareImgHeight = 250; // The image is square (1080x1080)
                const shareImgX = (pageW - shareImgWidth) / 2;
                if (y + shareImgHeight > doc.internal.pageSize.getHeight() - 64) { doc.addPage(); y = 64; }
                try {
                    doc.addImage(SHARE_IMG, "PNG", shareImgX, y, shareImgWidth, shareImgHeight, undefined, 'FAST');
                } catch (e) { console.error("Error loading share image for PDF:", e); }
                y += shareImgHeight + 24;

                const dmText = "Enviar DM";
                const dmUrl = "https://www.instagram.com/coach.danhd";
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                const dmTextWidth = doc.getStringUnitWidth(dmText) * doc.getFontSize();
                const dmButtonWidth = dmTextWidth + 60;
                const dmButtonHeight = 30;
                const dmButtonX = (pageW - dmButtonWidth) / 2;
                if (y + dmButtonHeight > doc.internal.pageSize.getHeight() - 64) { doc.addPage(); y = 64; }
                doc.setFillColor(0, 0, 0);
                doc.roundedRect(dmButtonX, y, dmButtonWidth, dmButtonHeight, 8, 8, 'F');
                doc.setTextColor(255, 255, 255);
                const textY = y + (dmButtonHeight / 2) + (doc.getTextDimensions(dmText).h / 2) - 2;
                doc.text(dmText, pageW / 2, textY, { align: 'center' });
                doc.link(dmButtonX, y, dmButtonWidth, dmButtonHeight, { url: dmUrl });
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                y += dmButtonHeight + 24;

                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setFontSize(10);
                    doc.setTextColor(150);
                    const pageText = `${i} / ${totalPages}`;
                    const textX = pageW / 2;
                    const textY_footer = doc.internal.pageSize.getHeight() - 20;
                    doc.text(pageText, textX, textY_footer, { align: 'center' });
                }

                doc.save("Mapa_Rapido_Zona_Desgaste.pdf");
            };

            // --- Event Listeners ---
            infoIcon.addEventListener('click', () => {
                infoModal.classList.remove('hidden');
            });
            closeModalBtn.addEventListener('click', () => {
                infoModal.classList.add('hidden');
            });
            infoModal.addEventListener('click', (e) => {
                if (e.target === infoModal) {
                    infoModal.classList.add('hidden');
                }
            });

            arcSlider.addEventListener('input', (e) => {
                // The raw slider value (0=left, 100=right) is inverted
                // so that moving the slider left increases the left value ("urgencias").
                arc = 100 - Number(e.target.value);
                arcValueDisplay.textContent = `${arc}%`; // Left label: Urgencies
                compArcDisplay.textContent = `${100 - arc}%`; // Right label: Directive role
                updateSliderTrack(e.target);
                sliderInteracted.arc = true;
                checkButtonState();
            });
            ceSlider.addEventListener('input', (e) => {
                // Invert for the same reason as above.
                ce = 100 - Number(e.target.value);
                ceValueDisplay.textContent = `${ce}%`; // Left label: Solving for others
                compCeDisplay.textContent = `${100 - ce}%`; // Right label: Directive role
                updateSliderTrack(e.target);
                sliderInteracted.ce = true;
                checkButtonState();
            });
            spSlider.addEventListener('input', (e) => {
                // Invert for the same reason as above.
                sp = 100 - Number(e.target.value);
                spValueDisplay.textContent = `${sp}%`; // Left label: Work
                compSpDisplay.textContent = `${100 - sp}%`; // Right label: Personal life
                updateSliderTrack(e.target);
                sliderInteracted.sp = true;
                checkButtonState();
            });
            
            verResultadoBtn.addEventListener('click', () => {
                const nen = Math.round((arc + ce + 3*sp) / 5);
                result = { nen, ...clasificar(arc, ce, sp, nen) };
                
                document.getElementById('resultTitulo').textContent = result.titulo;
                document.getElementById('resultNen').textContent = `${result.nen}%`;
                document.getElementById('resultMensaje').textContent = result.mensaje;
                
                formView.classList.add('hidden');
                resultView.classList.remove('hidden');
            });

            downloadPdfBtn.addEventListener('click', generarPDF);

            resetBtn.addEventListener('click', () => {
                arc = 50; ce = 50; sp = 50; result = null;
                arcSlider.value = 50; ceSlider.value = 50; spSlider.value = 50;
                
                sliderInteracted.arc = false;
                sliderInteracted.ce = false;
                sliderInteracted.sp = false;

                arcValueDisplay.textContent = `${arc}%`;
                compArcDisplay.textContent = `${100 - arc}%`;
                updateSliderTrack(arcSlider);

                ceValueDisplay.textContent = `${ce}%`;
                compCeDisplay.textContent = `${100 - ce}%`;
                updateSliderTrack(ceSlider);
                
                spValueDisplay.textContent = `${sp}%`;
                compSpDisplay.textContent = `${100 - sp}%`;
                updateSliderTrack(spSlider);

                checkButtonState();
                
                resultView.classList.add('hidden');
                formView.classList.remove('hidden');
            });
            
            // --- Initial Setup on Load ---
            arcSlider.value = arc;
            ceSlider.value = ce;
            spSlider.value = sp;

            arcValueDisplay.textContent = `${arc}%`;
            compArcDisplay.textContent = `${100-arc}%`;
            ceValueDisplay.textContent = `${ce}%`;
            compCeDisplay.textContent = `${100-ce}%`;
            spValueDisplay.textContent = `${sp}%`;
            compSpDisplay.textContent = `${100-sp}%`;
            
            checkButtonState();
            updateSliderTrack(arcSlider);
            updateSliderTrack(ceSlider);
            updateSliderTrack(spSlider);
        });
    </script>
</body>
</html>
